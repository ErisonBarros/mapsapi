{
    "collab_server" : "",
    "contents" : "#' Extract *routes* from Google Maps Directions API response\n#' @param doc XML document with Google Maps Directions API response\n#' @return Line layer (class \\code{sf}) representing routes\n#' @export\n#' @examples\n#' \\dontrun{\n#' doc = google_directions(\n#'   origin = c(34.81127, 31.89277),\n#'   destination = c(34.781107, 32.085003),\n#'   alternatives = TRUE\n#' )\n#' r = extract_routes(doc)\n#' }\n\nextract_routes = function(doc)  {\n\n  # Count alternative routes\n  alternatives =\n    doc %>%\n    xml_find_all(\"/DirectionsResponse/route\") %>%\n    length\n\n  routes = list()\n\n  for(i in 1:alternatives) {\n\n    route =\n      doc %>%\n      xml_find_all(sprintf(\"/DirectionsResponse/route[%s]/overview_polyline/points\", i)) %>%\n      xml_text\n\n    summary =\n      doc %>%\n      xml_find_all(sprintf(\"/DirectionsResponse/route[%s]/summary\", i)) %>%\n      xml_text\n\n    distance_m =\n      doc %>%\n      xml_find_all(sprintf(\"/DirectionsResponse/route[%s]/leg/step/distance/value\", i)) %>%\n      xml_text %>%\n      as.numeric %>%\n      sum\n\n    duration_s =\n      doc %>%\n      xml_find_all(sprintf(\"/DirectionsResponse/route[%s]/leg/step/duration/value\", i)) %>%\n      xml_text %>%\n      as.numeric %>%\n      sum\n\n    rt = lapply(route, decode_line)\n    rt = lapply(rt, st_linestring)\n    rt = lapply(rt, st_sfc, crs = 4326)\n    rt = do.call(c, rt)\n\n  routes[[i]] = st_sf(\n    alternative_id = i,\n    summary = summary,\n    distance_m = distance_m,\n    duration_s = duration_s,\n    geomerty = rt,\n    stringsAsFactors = FALSE\n    )\n\n  }\n\n  routes = do.call(rbind, routes)\n\n  return(routes)\n\n}\n\n\n",
    "created" : 1506064383813.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2773293812",
    "id" : "D5299804",
    "lastKnownWriteTime" : 1506266063,
    "last_content_update" : 1506266063049,
    "path" : "~/Dropbox/Packages/mapsapi/R/extract_routes.R",
    "project_path" : "R/extract_routes.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}