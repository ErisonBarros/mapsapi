{
    "collab_server" : "",
    "contents" : "#' Extract distance or duration *matrix* from a Google Maps Distance Matrix API response\n#' @param doc XML document with Google Maps Distance Matrix API response\n#' @param value Value to extract, one of: \\code{\"distance_m\"} (default), \\code{\"distance_text\"}, \\code{\"duration_s\"}, \\code{\"duration_text\"}\n#' @return \\code{matrix}\n#' @export\n#' @examples\n#' \\dontrun{\n#' locations = c(\"Haifa\", \"Tel-Aviv\", \"Jerusalem\", \"Beer-Sheva\")\n#' doc = google_matrix(\n#'   origins = locations,\n#'   destinations = locations\n#' )\n#' extract_matrix(doc, value = \"distance_m\")\n#' extract_matrix(doc, value = \"distance_text\")\n#' extract_matrix(doc, value = \"duration_s\")\n#' extract_matrix(doc, value = \"duration_text\")\n#' }\n\nextract_matrix = function(doc, value = \"distance_m\")  {\n\n  rows =\n    doc %>%\n    xml_find_all(\"/DistanceMatrixResponse/row\") %>%\n    length\n  cols =\n    doc %>%\n    xml_find_all(\"/DistanceMatrixResponse/row[1]/element\") %>%\n    length\n\n  origin_addresses =\n    doc %>%\n    xml_find_all(\"/DistanceMatrixResponse/origin_address\") %>%\n    xml_text\n  destination_addresses =\n    doc %>%\n    xml_find_all(\"/DistanceMatrixResponse/destination_address\") %>%\n    xml_text\n\n  m = matrix(NA, nrow = rows, ncol = cols)\n\n  for(row in 1:rows) {\n\n    for(col in 1:cols) {\n\n      val = switch(value,\n\n    distance_m =\n      doc %>%\n      xml_find_all(sprintf(\"/DistanceMatrixResponse/row[%s]/element[%s]/distance/value\", row, col)) %>%\n      xml_text %>%\n      as.numeric,\n\n    distance_text =\n      doc %>%\n      xml_find_all(sprintf(\"/DistanceMatrixResponse/row[%s]/element[%s]/distance/text\", row, col)) %>%\n      xml_text,\n\n    duration_s =\n      doc %>%\n      xml_find_all(sprintf(\"/DistanceMatrixResponse/row[%s]/element[%s]/duration/value\", row, col)) %>%\n      xml_text %>%\n      as.numeric,\n\n    duration_text =\n      doc %>%\n      xml_find_all(sprintf(\"/DistanceMatrixResponse/row[%s]/element[%s]/duration/text\", row, col)) %>%\n      xml_text\n\n      )\n\n    m[row, col] = val\n\n    }\n\n  }\n\n  rownames(m) = origin_addresses\n  colnames(m) = destination_addresses\n\n  return(m)\n\n}\n\n\n",
    "created" : 1506070465120.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2566769479",
    "id" : "B24D3D8C",
    "lastKnownWriteTime" : 1506101698,
    "last_content_update" : 1506101698296,
    "path" : "~/Dropbox/Packages/mapsapi/R/extract_matrix.R",
    "project_path" : "R/extract_matrix.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}